# Тесты для системы обработки исключений

## Описание

Набор тестов для проверки функциональности механизма обработки исключений в игре "Космическая битва".

## Покрытие тестами

### 1. LogCommandTests
Тесты для команды, которая записывает информацию о выброшенном исключении в лог:
- ✅ Создание лог-файла при его отсутствии
- ✅ Добавление записей в существующий лог-файл
- ✅ Корректность записываемой информации (команда, исключение, сообщение, время)
- ✅ Создание директории для лог-файла при необходимости
- ✅ Обработка ошибок (null-параметры, невалидные пути)

### 2. LogStrategyTests
Тесты для обработчика исключения, который ставит команду логирования в очередь:
- ✅ Создание LogCommand при вызове RecoverCommand
- ✅ Корректность параметров создаваемой команды
- ✅ Обработка различных типов исключений
- ✅ Работа с различными типами команд

### 3. RepeatCommandTests
Тесты для команды, которая повторяет команду, выбросившую исключение:
- ✅ Выполнение оригинальной команды
- ✅ Повторное выбрасывание исключения при ошибке
- ✅ Множественные выполнения
- ✅ Распаковка обёрнутых команд (Unwrap)
- ✅ Сохранение поведения оригинальной команды

### 4. RepeatOnceThenLogStrategyTests
Тесты для обработчика исключения, который ставит команду-повторитель в очередь:
- ✅ Создание RepeatCommand при первом исключении
- ✅ Создание LogCommand при повторном исключении
- ✅ Распаковка оригинальной команды при создании LogCommand
- ✅ Обработка вложенных RepeatCommand
- ✅ Работа с различными типами исключений
- ✅ Проверка выполнения созданных команд

### 5. CommandProcessorIntegrationTests
Интеграционные тесты для проверки работы всей системы:
- ✅ Добавление LogCommand в очередь при использовании LogStrategy
- ✅ Добавление RepeatCommand в очередь при использовании RepeatOnceThenLogStrategy

### 6. RepeatOnceThenLogIntegrationTests (Пункт 8)
Тесты для полного сценария обработки исключений:
- ✅ При первом выбросе исключения - создание RepeatCommand (повторить команду)
- ✅ При повторном выбросе исключения - создание LogCommand (записать в лог)
- ✅ Полный цикл: первое исключение → RepeatCommand → второе исключение → LogCommand
- ✅ Проверка распаковки оригинальной команды при создании LogCommand
- ✅ Сохранение информации об исключении в логе
- ✅ Интеграция с CommandProcessor для проверки работы в реальной очереди

### 7. RepeatTwiceThenLogStrategyTests
Тесты для стратегии "повторить два раза, потом записать в лог":
- ✅ Создание RepeatTwiceCommand при первом исключении (с двумя попытками)
- ✅ Продолжение повторения при втором исключении (если попытки еще есть)
- ✅ Создание LogCommand при третьем исключении (когда попытки закончились)
- ✅ Отслеживание количества попыток в RepeatTwiceCommand
- ✅ Полный цикл: первое → второе → третье исключение
- ✅ Распаковка оригинальной команды при создании LogCommand
- ✅ Обработка различных типов исключений

### 8. FailedAfterTwoAttemptsCommandTests
Тесты для команды, показывающей, что команду не удалось выполнить два раза:
- ✅ Выбрасывание InvalidOperationException при выполнении
- ✅ Содержание имени оригинальной команды в сообщении об исключении
- ✅ Обработка null-параметров в конструкторе
- ✅ Корректный формат сообщения об ошибке

### 9. FailedAfterTwoAttemptsStrategyTests
Тесты для стратегии с FailedAfterTwoAttemptsCommand:
- ✅ Создание RepeatTwiceCommand при первом исключении
- ✅ Продолжение повторения при втором исключении
- ✅ Создание FailedAfterTwoAttemptsCommand при третьем исключении (когда попытки закончились)
- ✅ Полный цикл обработки исключений
- ✅ Проверка выбрасывания исключения FailedAfterTwoAttemptsCommand

### 10. RepeatTwiceThenLogIntegrationTests
Интеграционные тесты для стратегии RepeatTwiceThenLogStrategy:
- ✅ Работа с CommandProcessor и очередью команд
- ✅ Отслеживание попыток в RepeatTwiceCommand
- ✅ Создание LogCommand после двух неудачных попыток

## Запуск тестов

```bash
dotnet test
```

## Структура тестов

- `LogCommandTests.cs` - тесты для команды логирования
- `LogStrategyTests.cs` - тесты для стратегии логирования
- `RepeatCommandTests.cs` - тесты для команды повтора
- `RepeatOnceThenLogStrategyTests.cs` - тесты для стратегии повтора с последующим логированием
- `CommandProcessorIntegrationTests.cs` - интеграционные тесты
- `RepeatOnceThenLogIntegrationTests.cs` - **тесты для пункта 8: полный сценарий обработки исключений**
- `RepeatTwiceThenLogStrategyTests.cs` - **тесты для стратегии "повторить два раза, потом записать в лог"**
- `FailedAfterTwoAttemptsCommandTests.cs` - **тесты для команды, показывающей неудачу после двух попыток**
- `FailedAfterTwoAttemptsStrategyTests.cs` - **тесты для стратегии с FailedAfterTwoAttemptsCommand**
- `RepeatTwiceThenLogIntegrationTests.cs` - **интеграционные тесты для RepeatTwiceThenLogStrategy**

## Вспомогательные классы

- `TestFailingCommand` - команда, которая всегда выбрасывает исключение
- `TestSuccessCommand` - команда, которая выполняется успешно
- `TestCountingCommand` - команда для подсчёта вызовов
- `TestModifyingCommand` - команда для изменения значений
- `TestConditionalFailingCommand` - команда, которая выбрасывает исключение при определенном условии
- `TestFailingCommandWithAttempts` - команда, которая выбрасывает исключение определенное количество раз